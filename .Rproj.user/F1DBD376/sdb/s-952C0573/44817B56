{
    "collab_server" : "",
    "contents" : "################################\n# Shiny app pour afficher les objets selon le temps \n# Octobre 2016\n# elements globaux pour explOH_5\n################################\n\noptions(encoding = \"UTF-8\")\n\n#librairies generales\nlibrary(shiny)\nlibrary(leaflet)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(shinythemes)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(RColorBrewer)\nlibrary(shinyjs)\n\n\n#SQl to R\nlibrary(RSQLite)\nlibrary(rgdal)\nlibrary(rgeos)\n\n#Import données\nsource(\"charge_data.R\", local=TRUE)\n\n#---- PALETTES ----\n#VURB\n# palette_f <- c(\"#e72535\", \"#2fc6a0\", \"#ff9819\", \"#0a60b2\", \"#7d3ab9\",\"#2ea949\")\npalette_f <- c(\"#e72535\", \"#0a8eb1\", \"#f6b01a\", \"#2fc6a0\", \"#703ab9\",\"#ff7919\")\n# palette <- c(\"#E03535\",\"#2C39E8\",\"#29FF81\",\"#E8D145\",\"#FF9D4D\",\"#3CE3E8\")\n# palette_f <- brewer.pal(6,\"Set1\")\n#display.brewer.all()\npalette_fonctions <- colorFactor(palette_f, unique(OH_ponctuels_4326@data$V_URB))\n#PORTEE\npalette_p <-c(\"#febd2b\", \"#fe892f\", \"#ff5733\", \"#ff2b37\")\npalette_portees <- colorFactor(palette_p, unique(OH_ponctuels_4326@data$PORTEE))\n#DUREE\nramp_duree <- colorNumeric(c(\"#ffeda0\",\"#800026\"), domain = OH_ponctuels_4326@data$OH_FIN - OH_ponctuels_4326@data$OH_DEB)\n# previewColors(colorFactor(palette, domain = NULL),unique(OH_ponctuels_4326@data$V_URB))\n#il y avait plus de niveaux dans v_urb que dans palette donc interpolation et couleurs moches\n#previewColors(colorRamp(c(\"#fee0d2\",\"#a50f15\")), OH_ponctuels_4326@data$DATE_FIN)\n\n\n\n#---- FONCTIONS POPUP ----\n\ntexte_popup_OH <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Nom : \", df@data$NOM, \"</b> <br/> OH n°\", df@data$OH_NUM,\n        \"</h5>Valeur d'usage : <b>\" ,  df@data$V_USAGE,\"</b> / \", df@data$NOM_USAGE,\n        \"<br/> Portée de niveau : <b>\", df@data$PORTEE, \"</b>\",\n        \"<br/> Apparition en <b>\", df@data$DATE_DEB, \"</b> (f\", df@data$FIAB_APP,\n        \"), dispartion en <b>\", df@data$DATE_FIN, \"</b> (f\", df@data$FIAB_DISP,\")<br/><br/> Remarques : \",\n        df@data$REMARQUES, \"<br/> Ref : \", df@data$REFERENCE)\n}\n\n\ntexte_popup_ens_urb <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b>\", df@data$nom, \" </h5> <br/>\", \n        df@data$date_debut,\"-\",df@data$date_fin,\"<br/> </b> Urbain : \", df@data$urbain,\n        \"<br/> Densité : \", df@data$densite,\n        \"<br/> Description : \", df@data$descriptio)\n}\n\n\ntexte_popup_traits_rive <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Trait de rive \", df@data$SELEC, \"</b> </h5>(\", df@data$DEBUT,\"-\",df@data$FIN,\")\")\n}\n\n#---- GGPLOT THEMES ----\n\n#theme ggplot facette clair\ntheme_facettes_clair <- function(){\n  theme(legend.position=\"none\",\n        \n        panel.grid.major.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.minor.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.major.y = element_line(color= \"#CDD2D4\", size= 0.5),\n        \n        axis.ticks =  element_line(color = \"#CDD2D4\"),\n        axis.text = element_text(colour = \"#CDD2D4\"),\n        axis.text.x = element_text(angle=90),\n        \n        text = element_text(colour = \"#F5F5F3\", face=\"bold\"),\n        plot.title = element_text(size = rel(1.8), face = \"bold\", margin = margin(10,10,20,10), hjust = 0.5),\n        \n        strip.background = element_rect(fill=\"#CDD2D4\"),\n        strip.text = element_text(colour = \"#FFFFFF\"),\n        \n        panel.background = element_rect(fill = \"#F5F5F3\",colour = NA),\n        plot.background = element_rect(fill = \"transparent\", colour = NA),\n        \n         # panel.spacing = margin(10), #ne marche pas avec les facettes\n         plot.margin = margin(20,20,10,20)\n  )\n}\n\n\n#---- preparation du tableau pour barplot -----------\n\n## préparation des tableaux de contingence\n#passage en valeurs urbaines\nOH_ponctuels_4326@data$V_URB = as.factor(OH_ponctuels_4326@data$V_URB)\n# structure du tableau\nnb_fonction_an <- as.data.frame(matrix(nrow=max(OH_ponctuels_4326@data$DATE_FIN)+1,ncol=6))\ncolnames(nb_fonction_an) <-c(1:6)\n# rownames(nb_fonction_an) <- as.numeric(rownames(nb_fonction_an))-1\nnb_fonction_an$annee <- as.numeric(rownames(nb_fonction_an))-1\n#remplissage du tableau\nfor (n in 1:6){ # pour toutes les colonnes valeurs urbaines existantes\n  for (i in 0:max(nb_fonction_an$annee)) { #pour toutes les lignes(2016)\n    nb_fonction_an[i+1,n] <- sum (OH_ponctuels_4326@data$V_URB==n & OH_ponctuels_4326@data$DATE_DEB<=i & OH_ponctuels_4326@data$DATE_FIN>=i)\n  } # remplir cette colonne de la somme des individus ayant cette valeur urbaine et ayant existé dans les bornes données\n}\n\nm_fonction_an <- melt(nb_fonction_an, id.vars=\"annee\")\nm_fonction_an$v_urb <- as.numeric(m_fonction_an$variable)\nm_fonction_an$v_urb <- cut (m_fonction_an$v_urb,\n                            breaks=c(1,2,3,4,5,6,7),\n                            labels=c(\"voirie, aménagement\",\n                                     \"structures défensives et militaires\",\n                                     \"constructions civiles\",\n                                     \"édifices relifieux\",\n                                     \"lieux d'inhumation\",\n                                     \"lieux de commerce, artisanat, production\"),\n                            right=FALSE,\n                            include.lowest = TRUE)\n\n\n#HTMLS\nsource.info <- HTML('<p class=\"titre_info\">Informations sur l\\'application : </p>L\\'application explOH permet d\\'explorer temporellement et spatialement les données \"Objets Historiques\" (OH) accompagnées de données de contextes, les \"ensembles urbains\" et les \"traits de rives\", provenant <a href=\"http://citeres.univ-tours.fr/spip.php?article504\", target=\"_blank\">SIG Topographie de Tours PréIndustrielle<a/>, développée au <a href=\"http://citeres.univ-tours.fr/spip.php?rubrique57\", target=\"_blank\">Laboratoire d\\'Archéologie Urbaine</a> à Tours (UMR 7324 CITERES).</br> </br>\nL\\'application est développée par <a href=\"http://www.parisgeo.cnrs.fr/spip.php?article6441\" target=\"_blank\">Lucie Nahassia</a> dans le cadre de sa thèse. Elle a pour objectif d\\'accompagner la lecture des analyses statistiques et spatiales développées au cours de ce travail en permettant au lecteur/utilisateur de naviguer par lui-même dans les données utilisées au niveau le plus élémentaire de l\\'individu topographique historique.')\n\nsource.usage <-HTML('<p class=\"titre_info\">Utilisation de l\\'application :</p>Sur la <p class=\"stitre_info\">carte</p>, <img src=\"icone_leaflet.png\", alt=\"l\\'icône en haut à droite\"> permet de choisir différents fonds de carte et d\\'afficher ou non les données OH et les données contextuelles. </br> </br>\nLe panneau <p class=\"stitre_info\">Sélection temporelle</p> permet réduire la période temporelle pour laquelles les OH sont afffichés, à l\\'aide d\\'un slider ou en rentrant manuellement les dates minimum et maximum pour un contrôle plus précis. Une seule année peut être sélectionnée en choisissant la même date pour les bornes  minimum et maximum. </br> </br>Le panneau <p class=\"stitre_info\">Identification des OH</p> permet de retrouver un OH par son identifiant, de modifier l\\'affichage des OH en fonction de leurs différents attributs, et d\\'afficher seulement certains OH en fonction de leur attribut fonctionnel.')\n\nsource.signature <- HTML(\n'<p class=\"signature\">',\n\"Application développée par\",\n\"<a href=\\\"http://www.parisgeo.cnrs.fr/spip.php?article6441\\\" target=\\\"_blank\\\">Lucie Nahassia</a>\",\n\", 2017\"\n)\n\n# \n# tags$p(class=\"signature\",\"Application en cours de développement par <a, href=\"http://www.parisgeo.cnrs.fr/spip.php?article6441\", target=\"_blank\">Lucie Nahassia</a>, 2017\")",
    "created" : 1494346515807.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1264317803",
    "id" : "44817B56",
    "lastKnownWriteTime" : 1494972621,
    "last_content_update" : 1494972621751,
    "path" : "C:/Users/lue/Sync/1recherche/1these/SIG/VISU/shiny/explOH/global.R",
    "project_path" : "global.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}