{
    "collab_server" : "",
    "contents" : "################################\n# Shiny app pour afficher les objets selon le temps \n# septembre 2017 \n# elements globaux pour explOH_9\n################################\n\noptions(encoding = \"UTF-8\")\n\n#librairies generales\nlibrary(shiny)\nlibrary(shinyjs)\nlibrary(shinyWidgets)\nlibrary(leaflet)\nlibrary(RSQLite)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(RColorBrewer)\nlibrary(stringi)\n\n\n#Spatialobjects\nlibrary(rgdal)\nlibrary(sf)\n\n#Import données\nsource(\"charge_data.R\", local=FALSE)\n\n#----------------------------------- VARIABLES GLOBALES ----\n\n#ligne NA pour addCircles de LeafletProxy\nnull_row <- OH_geom[st_geometry_type(OH_geom)==\"POINT\",][1,]\nnull_row$OH_NUM <- 0\n\n\n#----------------------------------- GRAPHIQUE TIMELINE ----\n\nnb_OH_an <- as.data.frame(matrix(nrow=max(OH_geom$DATE_FIN)+26,ncol=2))\ncolnames(nb_OH_an) <- c(\"annees\", \"nb_OH\")\nnb_OH_an$annees <- seq(-25,max(OH_geom$DATE_FIN))\nnb_OH_an$nb_OH <- apply(nb_OH_an, MARGIN = 1, function(x){sum (OH_geom$DATE_DEB<=x[1] & OH_geom$DATE_FIN>=x[1])})\n\nplot_nb_OH <- ggplot(nb_OH_an,aes(x=annees, y=nb_OH)) + \n  geom_area(fill=adjustcolor(\"grey\", alpha=0.5))+\n  geom_line(color=\"darkgrey\")+\n  theme_void()\n\n# ggplotly(plot_nb_OH)  \n\ntest<-ggplot(head(nb_OH_an), aes(x=annees, y=nb_OH)) + geom_point()\n\n#----------------------------------- PALETTES ----\n##VURB\n# palette_f <- c(\"#e72535\", \"#2fc6a0\", \"#ff9819\", \"#0a60b2\", \"#7d3ab9\",\"#2ea949\")\ncouleurs_vurb <- c(\"#e72535\", \"#0a8eb1\", \"#f6b01a\", \"#2fc6a0\", \"#703ab9\",\"#ff7919\")\n# palette <- c(\"#E03535\",\"#2C39E8\",\"#29FF81\",\"#E8D145\",\"#FF9D4D\",\"#3CE3E8\")\n# palette_f <- brewer.pal(6,\"Set1\")\n#display.brewer.all()\npalette_fonctions <- colorFactor(couleurs_vurb, levels(OH_geom$V_URB_NOM))\n##PORTEE\ncouleurs_portees <-c(\"#febd2b\", \"#fe892f\", \"#ff5733\", \"#ff2b37\")\npalette_portees <- colorFactor(couleurs_portees, unique(OH_geom$PORTEE))\n##DUREE\nramp_duree <- colorNumeric(c(\"#ffeda0\",\"#800026\"), domain = OH_geom$OH_FIN - OH_geom$OH_DEB)\n# previewColors(colorFactor(palette, domain = NULL),unique(OH_geom_4326@data$V_URB))\n#il y avait plus de niveaux dans v_urb que dans palette donc interpolation et couleurs moches\n#previewColors(colorRamp(c(\"#fee0d2\",\"#a50f15\")), OH_geom_4326@data$DATE_FIN)\n\n\n\n#----------------------------------- FONCTIONS POPUP ----\n\ntexte_popup_OH <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Nom : \", df$NOM, \"</b> <br/> OH n°\", df$OH_NUM,\n        \"</h5>Valeur d'usage : <b>\" ,  df$V_USAGE,\"</b> / \", df$NOM_USAGE,\n        \"<br/> Portée de niveau : <b>\", df$PORTEE, \"</b>\",\n        \"<br/> Apparition en <b>\", df$DATE_DEB, \"</b> (f\", df$FIAB_APP,\n        \"), dispartion en <b>\", df$DATE_FIN, \"</b> (f\", df$FIAB_DISP,\")<br/><br/> Remarques : \",\n        df$REMARQUES, \"<br/> Ref : \", df$REFERENCE)\n}\n\n\ntexte_popup_ens_urb <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b>\", df$nom, \" </h5> <br/>\", \n        df$date_debut,\"-\",df$date_fin,\"<br/> </b> Urbain : \", df$urbain,\n        \"<br/> Densité : \", df$densite,\n        \"<br/> Description : \", df$descriptio)\n}\n\n\ntexte_popup_traits_rive <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Trait de rive \", df$SELEC, \"</b> </h5>(\", df$DEBUT,\"-\",df$FIN,\")\")\n}\n\ntexte_popup_poles <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Pole urbain \", df$type, \" </h5>\", df$date_deb,\"-\",df$date_fin)\n}\n\n\n#----------------------------------- ICONES POLES ----\npolesIcons <- iconList(\n  economique = makeIcon(iconUrl=\"./img/icone_eco.png\"),\n  politique = makeIcon(iconUrl=\"./img/icone_pol.png\"),\n  religieux = makeIcon(iconUrl=\"./img/icone_rel.png\")\n  \n)\n\n\n#----------------------------------- GGPLOT THEMES ----\n\n#theme ggplot facette clair\ntheme_facettes_clair <- function(){\n  theme(legend.position=\"none\",\n        \n        panel.grid.major.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.minor.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.major.y = element_line(color= \"#CDD2D4\", size= 0.5),\n        \n        axis.ticks =  element_line(color = \"#CDD2D4\"),\n        axis.text = element_text(colour = \"#CDD2D4\"),\n        axis.text.x = element_text(angle=90),\n        \n        text = element_text(colour = \"#F5F5F3\", face=\"bold\"),\n        plot.title = element_text(size = rel(1.8), face = \"bold\", margin = margin(10,10,20,10), hjust = 0.5),\n        \n        strip.background = element_rect(fill=\"#CDD2D4\"),\n        strip.text = element_text(colour = \"#FFFFFF\"),\n        \n        panel.background = element_rect(fill = \"#F5F5F3\",colour = NA),\n        plot.background = element_rect(fill = \"transparent\", colour = NA),\n        \n         # panel.spacing = margin(10), #ne marche pas avec les facettes\n         plot.margin = margin(20,20,10,20)\n  )\n}\n\n\n#----------------------------------- éléments HTML ---------\n\nsource.info <- HTML('<p class=\"titre_info\">Informations sur l\\'application : </p>L\\'application explOH permet d\\'explorer temporellement et spatialement les données \"Objets Historiques\" (OH) accompagnées de données de contextes, les \"ensembles urbains\" et les \"traits de rives\", provenant <a href=\"http://citeres.univ-tours.fr/spip.php?article504\", target=\"_blank\">SIG Topographie de Tours PréIndustrielle<a/>, développée au <a href=\"http://citeres.univ-tours.fr/spip.php?rubrique57\", target=\"_blank\">Laboratoire d\\'Archéologie Urbaine</a> à Tours (UMR 7324 CITERES).</br> </br>\nL\\'application est développée par <a href=\"http://www.parisgeo.cnrs.fr/spip.php?article6441\" target=\"_blank\">Lucie Nahassia</a> dans le cadre de sa thèse. Elle a pour objectif d\\'accompagner la lecture des analyses statistiques et spatiales développées au cours de ce travail en permettant au lecteur/utilisateur de naviguer par lui-même dans les données utilisées au niveau le plus élémentaire de l\\'individu topographique historique.')\n\nsource.usage <-HTML('<p class=\"titre_info\">Utilisation de l\\'application :</p>Sur la <p class=\"stitre_info\">carte</p>, <img src=\"icone_leaflet.png\", alt=\"l\\'icône en haut à droite\"> permet de choisir différents fonds de carte et d\\'afficher ou non les données OH et les données contextuelles. </br> </br>\nLe panneau <p class=\"stitre_info\">Sélection temporelle</p> permet choisir la période temporelle pour laquelles les OH sont afffichés en rentrant manuellement les dates minimum et maximum pour un contrôle plus précis que le slider. Une seule année peut être sélectionnée en choisissant la même date pour les bornes  minimum et maximum. </br> </br>Le panneau <p class=\"stitre_info\">Identification des OH</p> permet de retrouver un OH par son identifiant, de modifier l\\'affichage des OH en fonction de leurs différents attributs, et d\\'afficher seulement certains OH en fonction de leur attribut fonctionnel.')\n\nsource.signature <- HTML(\n'<p class=\"signature\">',\n\"Application développée par\",\n\"<a href=\\\"http://www.parisgeo.cnrs.fr/spip.php?article6441\\\" target=\\\"_blank\\\">Lucie Nahassia</a>\",\n\", 2017\"\n)",
    "created" : 1504515810106.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2988538341",
    "id" : "6B1326ED",
    "lastKnownWriteTime" : 1509034254,
    "last_content_update" : 1509034254473,
    "path" : "C:/Users/lue/Sync/1recherche/1these/SIG/VISU/shiny/explOH_9/global.R",
    "project_path" : "global.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}