{
    "contents" : "################################\n# Shiny app pour afficher les objets selon le temps \n# Octobre 2016\n# elements globaux pour shiny_3_2geom\n################################\n\noptions(encoding = \"UTF-8\")\n\n#librairies generales\nlibrary(shiny)\nlibrary(leaflet)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(shinythemes)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(RColorBrewer)\nlibrary(shinyjs)\n\n\n#SQl to R\nlibrary(RSQLite)\nlibrary(rgdal)\nlibrary(rgeos)\n\n#Import données\nsource(\"charge_data.R\", local=TRUE)\n\n#palette de couleur pour les fonction\n#palette <- c(\"#e72535\", \"#0a8eb1\", \"#f6b01a\", \"#2fc6a0\", \"#703ab9\",\"#ff7919\")\n#palette <- c(\"#E03535\",\"#2C39E8\",\"#29FF81\",\"#E8D145\",\"#FF9D4D\",\"#3CE3E8\")\npalette <- brewer.pal(6,\"Set1\")\n#display.brewer.all()\n\n#---- FONCTIONS POPUP ----\n\npopup_text <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b> Nom : \", df@data$NOM, \"</b> <br/> OH n°\", df@data$OH_NUM,\n        \"</h5>Valeur d'usage : \",  df@data$V_USAGE,\" / \", df@data$NOM_USAGE,\n        \"<br/> apparition en <b>\", df@data$DATE_DEB, \"</b> (f\", df@data$FIAB_APP,\n        \"), dispartion en <b>\", df@data$DATE_FIN, \"</b> (f\", df@data$FIAB_DISP,\")<br/><br/> Remarques : \",\n        df@data$REMARQUES, \"<br/> Ref : \", df@data$REFERENCE)\n}\n\n\npopup_ens_urb <- function(df) {\n  paste(sep=\"\",\n        \"<h5> <b>\", df@data$NOM_LONG, \"</b> (\", df@data$DEBUT,\"-\",df@data$FIN,\") </h5>\")\n}\n\n#---- GGPLOT THEMES ----\n\n#theme ggplot facette clair\ntheme_facettes_clair <- function(){\n  theme(legend.position=\"none\",\n        \n        panel.grid.major.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.minor.x = element_line(color = \"#CDD2D4\", linetype =\"dotted\", size = 0.5),\n        panel.grid.major.y = element_line(color= \"#CDD2D4\", size= 0.5),\n        \n        axis.ticks =  element_line(color = \"#CDD2D4\"),\n        axis.text = element_text(colour = \"#CDD2D4\"),\n        axis.text.x = element_text(angle=90),\n        \n        text = element_text(colour = \"#F5F5F3\", face=\"bold\"),\n        plot.title = element_text(size = rel(1.8), face = \"bold\", margin = margin(10,10,20,10), hjust = 0.5),\n        \n        strip.background = element_rect(fill=\"#CDD2D4\"),\n        strip.text = element_text(colour = \"#FFFFFF\"),\n        \n        panel.background = element_rect(fill = \"#F5F5F3\",colour = NA),\n        plot.background = element_rect(fill = \"transparent\", colour = NA),\n        \n         # panel.spacing = margin(10), #ne marche pas avec les facettes\n         plot.margin = margin(20,20,10,20)\n  )\n}\n\n\n#---- preparation du tableau pour barplot -----------\n\n## préparation des tableaux de contingence\n#passage en valeurs urbaines\nOH_ponctuels_4326@data$V_URB = as.factor(OH_ponctuels_4326@data$V_URB)\n# structure du tableau\nnb_fonction_an <- as.data.frame(matrix(nrow=max(OH_ponctuels_4326@data$DATE_FIN)+1,ncol=6))\ncolnames(nb_fonction_an) <-c(1:6)\n# rownames(nb_fonction_an) <- as.numeric(rownames(nb_fonction_an))-1\nnb_fonction_an$annee <- as.numeric(rownames(nb_fonction_an))-1\n#remplissage du tableau\nfor (n in 1:6){ # pour toutes les colonnes valeurs urbaines existantes\n  for (i in 0:max(nb_fonction_an$annee)) { #pour toutes les lignes(2016)\n    nb_fonction_an[i+1,n] <- sum (OH_ponctuels_4326@data$V_URB==n & OH_ponctuels_4326@data$DATE_DEB<=i & OH_ponctuels_4326@data$DATE_FIN>=i)\n  } # remplir cette colonne de la somme des individus ayant cette valeur urbaine et ayant existé dans les bornes données\n}\n\nm_fonction_an <- melt(nb_fonction_an, id.vars=\"annee\")\nm_fonction_an$v_urb <- as.numeric(m_fonction_an$variable)\nm_fonction_an$v_urb <- cut (m_fonction_an$v_urb,\n                            breaks=c(1,2,3,4,5,6,7),\n                            labels=c(\"voirie, aménagement\",\n                                     \"structures défensives et militaires\",\n                                     \"constructions civiles\",\n                                     \"édifices relifieux\",\n                                     \"lieux d'inhumation\",\n                                     \"lieux de commerce, artisanat, production\"),\n                            right=FALSE,\n                            include.lowest = TRUE)\n\n",
    "created" : 1465164592594.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1494546691",
    "id" : "D6E4C475",
    "lastKnownWriteTime" : 1480956537,
    "path" : "C:/Users/lue/Sync/1recherche/1these/SIG/VISU/visu_temps/shiny_3_2geom/global.R",
    "project_path" : "global.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}